;(function(){var baseUrl;var __factory=function(){var module=(function(dependencies){return function(init){return init.call({},(function(){return{getSpaghettiVersion:function(){return "13.0-25-g6015dbc";},getModuleName:function(){return "prezi_ppt_common";},getModuleVersion:function(){return "release-2021w06-base-26-gaeb382e";},getResourceUrl:function(resource){if(resource.substr(0,1)!="/"){resource="/"+resource;}return baseUrl+resource;},"dependencies":{"prezi_i18n":dependencies[0],"prezi_logger":dependencies[1],"prezi_utils":dependencies[2],"prezi_widgets":dependencies[3]}};})());};})(arguments);var moduleImpl=(function(){return module(function(g){var l=g.dependencies.prezi_i18n,k=g.dependencies.prezi_logger,q=g.dependencies.prezi_utils,p=g.dependencies.prezi_widgets,h={};Object.defineProperty(h,"__esModule",{value:!0});h.UploadTimerImpl=class{constructor(a,b){this.progressState=a;this.PptBackendWorkTime=22E3;this.timerCreator=b;this.reset()}initState(){this.state={timer:null};this.progressState.setStartTime(-1);this.progressState.setTimeout(1E3);this.progressState.setFileUploadPercentage(0);this.progressState.setFileUploadFinishedTime(-1);
this.progressState.setPrevPercentage(null);this.progressState.setLastPercentageCalculationTime(-1);this.progressState.setFinished(!1)}updateFileUploadPercentage(a){this.isRunning()&&(this.progressState.setFileUploadPercentage(a),100===a&&this.progressState.setFileUploadFinishedTime(this.timerCreator.getTime()-this.progressState.getStartTime()),this.doWork())}isRunning(){return!this.progressState.getFinished()&&null!=this.state&&null!=this.state.timer}finish(){this.progressState.setFinished(!0);null!=
this.state&&null!=this.state.timer&&this.timerCreator.clearIntervalTimer()(this.state.timer)}reset(){null!=this.state&&null!=this.state.timer&&this.timerCreator.clearIntervalTimer()(this.state.timer);this.initState()}calculateProgressPercentage(){if(this.progressState.getFinished())return{percentage:100,remainingTime:0};if(-1===this.progressState.getStartTime()||3>this.progressState.getFileUploadPercentage())return{percentage:-1,remainingTime:-1};const a=this.timerCreator.getTime();var b=a-this.progressState.getStartTime(),
d=100*b/this.progressState.getFileUploadPercentage(),c=-1===this.progressState.getFileUploadFinishedTime()?d:this.progressState.getFileUploadFinishedTime();d=this.progressState.getProgressPercentage();var e=c+this.PptBackendWorkTime;c=Math.max(0,e-b);b=Math.min(100,b/e*100);e=null!=this.progressState.getPrevPercentage()?this.progressState.getPrevPercentage():d;d=Math.min(100,Math.max(d,b));b>e+10&&(d=e);if(80<d)return 3E3<a-this.progressState.getLastPercentageCalculationTime()?(this.progressState.setPrevPercentage(e+
1),this.progressState.setLastPercentageCalculationTime(this.timerCreator.getTime()),{percentage:e+1,remainingTime:0}):{percentage:Math.min(100,e),remainingTime:this.progressState.getRemainingTime()};this.progressState.setLastPercentageCalculationTime(this.timerCreator.getTime());this.progressState.setPrevPercentage(b);return{percentage:d,remainingTime:c}}doWork(){if(!this.progressState.getFinished()){var a=this.progressState.getProgressPercentage();if(null==a)this.reset();else{var b=this.calculateProgressPercentage(),
d=0<b.percentage?b.remainingTime:-1;this.progressState.setProgressPercentage(Math.min(0<b.percentage?b.percentage:a,100));this.progressState.setRemainingTime(d)}}}run(){this.reset();this.progressState.setStartTime(this.timerCreator.getTime());this.state.timer=this.timerCreator.createIntervalTimer()(()=>this.doWork(),this.progressState.getTimeOut())}};h.TimerCreatorImpl=class{createIntervalTimer(){return setInterval}clearIntervalTimer(){return clearInterval}getTime(){return(new Date).getTime()}};var m=
{};Object.defineProperty(m,"__esModule",{value:!0});var f;(function(a){a[a.MINUTES=0]="MINUTES";a[a.LESS_THAN_1_MINUTE=1]="LESS_THAN_1_MINUTE";a[a.SECONDS=2]="SECONDS"})(f||(f={}));m.PptUploadUtilsImpl=class{constructor(){this.logger=k.LoggerModule.getLoggerManager().createLogger("prezi_ppt_common.PptUploadUtils")}logFilePickedForPptUpload(a,b){k.avro.Avro.createDefaultLogger().logFilePickedForPptUpload({ppt_import_flow_version:"VERSION_TWO",file_name:a.name,file_size:a.size,file_source:b})}logUploadStarted(a,
b){this.logUpload(a,b,"upload_first_result",{ppt_import_flow_version:"VERSION_TWO",ppt_import_progress:"STARTED"})}logUploadComplete(a,b){this.logUpload(a,b,"upload_complete",{ppt_import_flow_version:"VERSION_TWO",ppt_import_progress:"COMPLETE"})}logUploadError(a,b,d=null){this.logUpload(a,b,"upload_error",{ppt_import_flow_version:"VERSION_TWO",ppt_import_progress:"ERROR"},d)}logUploadFirstResult(a,b){this.logUpload(a,b,"upload_first_result",{ppt_import_flow_version:"VERSION_TWO",ppt_import_progress:"FIRST_RESULT"})}logInvalidFileExtension(){throw Error("Method not implemented.");
}logUpload(a,b,d,c,e=null){a=Object.assign(Object.assign({},this.logEntryCreator(a,b)),{action:d});null!=c&&k.avro.Avro.createDefaultLogger().logPptUploadProgress(c);null!=e?k.LoggerModule.logException(this.logger,a.object,a.action,e,a.payload,a.trigger):"upload_error"===d?this.logger.error(a):this.logger.info(a)}isValidPowerPoint(a){return null==a?!1:null!=a.name.match(/.*\.pptx?$/i)}logFileExtensionError(a,b,c){a=Object.assign(Object.assign({},this.logEntryCreator(a,b)),{action:"upload_with_invalid_extension",
payload:{extension:this.getFileExtension(c)}});this.logger.warn(a)}calculateProgressMessage(a){return this.progressMessageToString(this.calculateProgressBarMessageState(a))}progressMessageToString(a){switch(a){case f.LESS_THAN_1_MINUTE:return l.I18n.ts("Less than a minute to go");case f.MINUTES:return l.I18n.ts("Over a minute remaining");case f.SECONDS:return l.I18n.ts("A few seconds left");default:return q.Utils.assertNever(a)}}calculateProgressBarMessageState(a){return 6E4<a?f.MINUTES:1E4<a?f.LESS_THAN_1_MINUTE:
0<=a&&1E4>a?f.SECONDS:f.LESS_THAN_1_MINUTE}logEntryCreator(a,b){a=null!=a?Date.now()-a:void 0;return{object:"ppt",trigger:"machine",payload:{job_id:b,elapsed_time_ms:a}}}getFileExtension(a){if(null==a)return"";a=a.match(/.*\.([^.]+)$/);return null!=a&&2===a.length?a[1]:""}calculateProgressBarControl(a){switch(a){case c.UploadState.Error:return p.ProgressBarControl.Restart;case c.UploadState.Uploading:case c.UploadState.UploadFinished:return p.ProgressBarControl.Cancel}}};var n={};Object.defineProperty(n,
"__esModule",{value:!0});n.ProgressStateImpl=class{constructor(a){this.stateHandler=a}getProgressPercentage(){return null==this.stateHandler.getProcess()?null:this.stateHandler.getProcess().progress.percentage}setProgressPercentage(a){this.stateHandler.setProcess({progress:Object.assign(Object.assign({},this.stateHandler.getProcess().progress),{percentage:a})})}getRemainingTime(){return null==this.stateHandler.getProcess()||null==this.stateHandler.getProcess().progress||null==this.stateHandler.getProcess().progress.prevPercentage?
null:this.stateHandler.getProcess().progress.remainingTime}setRemainingTime(a){this.stateHandler.setProcess(Object.assign(Object.assign({},this.stateHandler.getProcess()),{progress:Object.assign(Object.assign({},this.stateHandler.getProcess().progress),{remainingTime:a})}))}getStartTime(){return null==this.stateHandler.getProcess()||null==this.stateHandler.getProcess().progress?null:this.stateHandler.getProcess().progress.startTime}setStartTime(a){this.stateHandler.setProcess(Object.assign(Object.assign({},
this.stateHandler.getProcess()),{progress:Object.assign(Object.assign({},this.stateHandler.getProcess().progress),{startTime:a})}))}getTimeOut(){return null==this.stateHandler.getProcess()||null==this.stateHandler.getProcess().progress?null:this.stateHandler.getProcess().progress.timeOut}setTimeout(a){this.stateHandler.setProcess(Object.assign(Object.assign({},this.stateHandler.getProcess()),{progress:Object.assign(Object.assign({},this.stateHandler.getProcess().progress),{timeOut:a})}))}getFileUploadPercentage(){return null==
this.stateHandler.getProcess()||null==this.stateHandler.getProcess().progress?null:this.stateHandler.getProcess().progress.fileUploadPercentage}setFileUploadPercentage(a){this.stateHandler.setProcess(Object.assign(Object.assign({},this.stateHandler.getProcess()),{progress:Object.assign(Object.assign({},this.stateHandler.getProcess().progress),{fileUploadPercentage:a})}))}getFileUploadFinishedTime(){return null==this.stateHandler.getProcess()||null==this.stateHandler.getProcess().progress?null:this.stateHandler.getProcess().progress.fileUploadFinishedTime}setFileUploadFinishedTime(a){this.stateHandler.setProcess(Object.assign(Object.assign({},
this.stateHandler.getProcess()),{progress:Object.assign(Object.assign({},this.stateHandler.getProcess().progress),{fileUploadFinishedTime:a})}))}getPrevPercentage(){return null==this.stateHandler.getProcess()||null==this.stateHandler.getProcess().progress?null:this.stateHandler.getProcess().progress.prevPercentage}setPrevPercentage(a){this.stateHandler.setProcess(Object.assign(Object.assign({},this.stateHandler.getProcess()),{progress:Object.assign(Object.assign({},this.stateHandler.getProcess().progress),
{prevPercentage:a})}))}getLastPercentageCalculationTime(){return null==this.stateHandler.getProcess()||null==this.stateHandler.getProcess().progress?null:this.stateHandler.getProcess().progress.lastPercentageCalculationTime}setLastPercentageCalculationTime(a){this.stateHandler.setProcess({progress:Object.assign(Object.assign({},this.stateHandler.getProcess().progress),{lastPercentageCalculationTime:a})})}getFinished(){return null==this.stateHandler.getProcess()||null==this.stateHandler.getProcess().progress?
null:this.stateHandler.getProcess().progress.finished}setFinished(a){this.stateHandler.setProcess(Object.assign(Object.assign({},this.stateHandler.getProcess()),{progress:Object.assign(Object.assign({},this.stateHandler.getProcess().progress),{finished:a})}))}};var c={};Object.defineProperty(c,"__esModule",{value:!0});(function(a){a[a.Idle=0]="Idle";a[a.Uploading=1]="Uploading";a[a.InvalidFileExtension=2]="InvalidFileExtension";a[a.Error=3]="Error";a[a.UploadFinished=4]="UploadFinished"})(g=c.UploadState||
(c.UploadState={}));c.IDLE_STATE_COMMON={jobId:null,fileName:null,state:g.Idle,progress:{percentage:0,remainingTime:-1,startTime:-1,timeOut:1E3,fileUploadPercentage:0,fileUploadFinishedTime:-1,prevPercentage:null,lastPercentageCalculationTime:-1,finished:!1},modalShown:!1};c.uploadModalId="pptPreloadUploadModal";c.createUploadTimer=function(a){return new h.UploadTimerImpl(a,new h.TimerCreatorImpl)};c.createPptUploadUtils=function(){return new m.PptUploadUtilsImpl};c.createProgressState=function(a){return new n.ProgressStateImpl(a)};
return c});

})() || {};
moduleImpl["module"]=moduleImpl;
return moduleImpl;};if(typeof define==="function"&&define.amd){define("prezi_ppt_common",["require","prezi_i18n","prezi_logger","prezi_utils","prezi_widgets"],function(){var moduleUrl=arguments[0]["toUrl"]("prezi_ppt_common.js");baseUrl=moduleUrl.substr(0,moduleUrl.lastIndexOf("/"));return(__factory).apply({},[].slice.call(arguments,1));});}else if(typeof exports==="object"&&typeof exports.nodeName!=="string"){baseUrl=__dirname;module.exports=(__factory)(require("prezi_i18n"),require("prezi_logger"),require("prezi_utils"),require("prezi_widgets"));}else{this["prezi_ppt_common"]=__factory(this["prezi_i18n"],this["prezi_logger"],this["prezi_utils"],this["prezi_widgets"]);}}).call(this);