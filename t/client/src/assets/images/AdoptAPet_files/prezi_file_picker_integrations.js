;(function(){var baseUrl;var __factory=function(){var module=(function(dependencies){return function(init){return init.call({},(function(){return{getSpaghettiVersion:function(){return "13.0-25-g6015dbc";},getModuleName:function(){return "prezi_file_picker_integrations";},getModuleVersion:function(){return "release-2021w06-base-26-gaeb382e";},getResourceUrl:function(resource){if(resource.substr(0,1)!="/"){resource="/"+resource;}return baseUrl+resource;},"dependencies":{"prezi_editor_commander":dependencies[0],"prezi_featureswitcher":dependencies[1],"prezi_i18n":dependencies[2],"prezi_logger":dependencies[3],"prezi_plugin_api":dependencies[4],"prezi_plugin_meta":dependencies[5],"prezi_utils":dependencies[6]}};})());};})(arguments);var moduleImpl=(function(){return module(function(n){var w=n.dependencies.prezi_featureswitcher,k=n.dependencies.prezi_plugin_api,q=n.dependencies.prezi_i18n,v=n.dependencies.prezi_utils,x=n.dependencies.prezi_logger,f={},y=this&&f.__awaiter||function(a,e,b,c){function d(a){return a instanceof b?a:new b(function(b){b(a)})}return new (b||(b=Promise))(function(b,m){function l(a){try{g(c.next(a))}catch(h){m(h)}}function f(a){try{g(c["throw"](a))}catch(h){m(h)}}function g(a){a.done?b(a.value):d(a.value).then(l,f)}g((c=c.apply(a,e||[])).next())})};
Object.defineProperty(f,"__esModule",{value:!0});f.FilePickerBase=class{selectFile(a){this.logOpenUploadDialog(a);return this.doSelectFile(a)}logOpenUploadDialog(a){x.avro.Avro.createDefaultLogger().logOpenUploadDialog({upload_object_type:k.FileFilter.getExtensions(a).join(","),upload_source:this.getFilePickerRegisterData().id})}fetchFile(a,e,b,c){return y(this,void 0,void 0,function*(){const d=yield(yield fetch(a,c)).blob();b||(b=v.Utils.getMimeTypeFromExtension(e));return v.Utils.createFile(d,e,
b)})}};var r={},z=this&&r.__awaiter||function(a,e,b,c){function d(a){return a instanceof b?a:new b(function(b){b(a)})}return new (b||(b=Promise))(function(b,m){function l(a){try{g(c.next(a))}catch(h){m(h)}}function f(a){try{g(c["throw"](a))}catch(h){m(h)}}function g(a){a.done?b(a.value):d(a.value).then(l,f)}g((c=c.apply(a,e||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0});r.FilePickerOneDrive=class extends f.FilePickerBase{constructor(){super(...arguments);this.OneDrive=null;this.clientId=
"7ebf409d-e9aa-4a05-b5c4-7c345cbbef4e";this.redirectUri="localhost"===location.hostname?"http://localhost:9081/modules/prezi_code_snippet_editor/html/authRedirect.html":"https://prezi.com/air-integrations/onedrive.html"}getFilePickerRegisterData(){return{id:"ONEDRIVE",name:q.I18n.ts("Upload from OneDrive"),icon:k.IconSmallId.OneDrive,selectFile:(a)=>this.selectFile(a)}}doSelectFile(a){return z(this,void 0,void 0,function*(){null==this.OneDrive&&(this.OneDrive=yield this.loadOneDrive());return new Promise((e,
b)=>{const c={clientId:this.clientId,multiSelect:!1,action:"download",advanced:{redirectUri:this.redirectUri,queryParameters:"select=id,name,size,file,folder,photo,@microsoft.graph.downloadUrl",filter:k.FileFilter.getExtensions(a).join(",")},success:(a)=>{try{const b=this.fetchFile(a.value[0]["@microsoft.graph.downloadUrl"],a.value[0].name,a.value[0].file.mimeType);e(b)}catch(l){b(l)}},cancel:()=>{},error:(a)=>{b(a)}};this.OneDrive.open(c)})})}loadOneDrive(){return new Promise((a)=>{require(["https://js.live.net/v7.2/OneDrive.js"],
(e)=>{a(e)})})}};var p={},A=this&&p.__awaiter||function(a,e,b,c){function d(a){return a instanceof b?a:new b(function(b){b(a)})}return new (b||(b=Promise))(function(b,f){function l(a){try{g(c.next(a))}catch(h){f(h)}}function m(a){try{g(c["throw"](a))}catch(h){f(h)}}function g(a){a.done?b(a.value):d(a.value).then(l,m)}g((c=c.apply(a,e||[])).next())})};Object.defineProperty(p,"__esModule",{value:!0});p.FilePickerGoogleDrive=class extends f.FilePickerBase{getFilePickerRegisterData(){return{id:"GDRIVE",
name:q.I18n.ts("Upload from Google Drive"),icon:k.IconSmallId.GoogleDrive,selectFile:(a)=>this.selectFile(a)}}doSelectFile(a){return A(this,void 0,void 0,function*(){return new Promise((e)=>{const b=this.buildIFrame(),c=(d)=>{"getPickerParameters"===d.data.type?d.source.postMessage({mimeTypes:k.FileFilter.getMimeTypes(a).join(","),locale:p.FilePickerGoogleDrive.getLocale()},d.origin):"selectedFile"===d.data.type?(d=d.data.data,d=this.fetchFile(`https://www.googleapis.com/drive/v3/files/${d.fileId}?alt=media`,
d.fileName,d.mimeType,d.headers),b.parentElement.removeChild(b),window.removeEventListener("message",c,!0),e(d)):"cancelled"===d.data.type&&(b.parentElement.removeChild(b),window.removeEventListener("message",c,!0))};window.addEventListener("message",c,!0);document.body.appendChild(b)})})}buildIFrame(){let a=document.createElement("iframe");a.style.position="absolute";a.style.top="0";a.style.left="0";a.style.width="100%";a.style.height="100%";a.style.zIndex="9000";fetch(n.getResourceUrl("index.html")).then((a)=>
a.text()).then((e)=>a.contentDocument.write(e));return a}static getLocale(){const a=q.I18n.getLanguage();return"pt"===a?"pt-PT":a}};var t={},B=this&&t.__awaiter||function(a,e,b,c){function d(a){return a instanceof b?a:new b(function(b){b(a)})}return new (b||(b=Promise))(function(b,f){function k(a){try{g(c.next(a))}catch(h){f(h)}}function l(a){try{g(c["throw"](a))}catch(h){f(h)}}function g(a){a.done?b(a.value):d(a.value).then(k,l)}g((c=c.apply(a,e||[])).next())})};Object.defineProperty(t,"__esModule",
{value:!0});t.FilePickerDropbox=class extends f.FilePickerBase{constructor(){super(...arguments);this.appKey="0n0i9dzokjah7uq";this.scriptSrc="https://www.dropbox.com/static/api/2/dropins.js";this.Dropbox=null}getFilePickerRegisterData(){return{id:"DROPBOX",name:q.I18n.ts("Upload from Dropbox"),icon:k.IconSmallId.Dropbox,selectFile:(a)=>this.selectFile(a)}}doSelectFile(a){return B(this,void 0,void 0,function*(){null==this.Dropbox&&(this.Dropbox=yield this.loadScript());return new Promise((e)=>{const b=
{linkType:"direct",multiselect:!1,extensions:k.FileFilter.getExtensions(a),folderselect:!1,success:(a)=>{e(this.fetchFile(a[0].link,a[0].name))}};this.Dropbox.choose(b)})})}loadScript(){return new Promise((a,e)=>{const b=document.createElement("script");b.onload=()=>a(Dropbox);b.onerror=()=>e();b.type="text/javascript";b.src=this.scriptSrc;b.setAttribute("data-app-key",this.appKey);b.setAttribute("id","dropboxjs");document.body.appendChild(b)})}};var u={};Object.defineProperty(u,"__esModule",{value:!0});
u.FilePickerIntegrationsPlugin=class{init(a){a.registerFilePicker((new r.FilePickerOneDrive).getFilePickerRegisterData());w.isActive("js-editor-enable-filepicker-googledrive")&&a.registerFilePicker((new p.FilePickerGoogleDrive).getFilePickerRegisterData());a.registerFilePicker((new t.FilePickerDropbox).getFilePickerRegisterData())}};f={};Object.defineProperty(f,"__esModule",{value:!0});f.lazyModule={createPlugin(){return new u.FilePickerIntegrationsPlugin}};return f});

})() || {};
moduleImpl["module"]=moduleImpl;
return moduleImpl;};if(typeof define==="function"&&define.amd){define("prezi_file_picker_integrations",["require","prezi_editor_commander","prezi_featureswitcher","prezi_i18n","prezi_logger","prezi_plugin_api","prezi_plugin_meta","prezi_utils"],function(){var moduleUrl=arguments[0]["toUrl"]("prezi_file_picker_integrations.js");baseUrl=moduleUrl.substr(0,moduleUrl.lastIndexOf("/"));return(__factory).apply({},[].slice.call(arguments,1));});}else if(typeof exports==="object"&&typeof exports.nodeName!=="string"){baseUrl=__dirname;module.exports=(__factory)(require("prezi_editor_commander"),require("prezi_featureswitcher"),require("prezi_i18n"),require("prezi_logger"),require("prezi_plugin_api"),require("prezi_plugin_meta"),require("prezi_utils"));}else{this["prezi_file_picker_integrations"]=__factory(this["prezi_editor_commander"],this["prezi_featureswitcher"],this["prezi_i18n"],this["prezi_logger"],this["prezi_plugin_api"],this["prezi_plugin_meta"],this["prezi_utils"]);}}).call(this);