;(function(){var baseUrl;var __factory=function(){var module=(function(dependencies){return function(init){return init.call({},(function(){return{getSpaghettiVersion:function(){return "13.0-25-g6015dbc";},getModuleName:function(){return "prezi_font_selector";},getModuleVersion:function(){return "release-2021w06-base-26-gaeb382e";},getResourceUrl:function(resource){if(resource.substr(0,1)!="/"){resource="/"+resource;}return baseUrl+resource;},"dependencies":{"prezi_cet_model_editor":dependencies[0],"prezi_featureswitcher":dependencies[1],"prezi_font_provider":dependencies[2],"prezi_i18n":dependencies[3],"prezi_logger":dependencies[4],"prezi_plugin_api":dependencies[5],"prezi_plugin_meta":dependencies[6],"prezi_service_fontcatalogue":dependencies[7],"prezi_utils":dependencies[8],"prezi_widgets":dependencies[9]}};})());};})(arguments);var moduleImpl=(function(){return module(function(f){var e=f.dependencies.prezi_plugin_api,d=f.dependencies.prezi_i18n,b=f.dependencies.prezi_font_provider,v=f.dependencies.prezi_featureswitcher;f=f.dependencies.prezi_logger;var m={},n=this&&m.__awaiter||function(a,c,g,b){function l(a){return a instanceof g?a:new g(function(c){c(a)})}return new (g||(g=Promise))(function(g,r){function w(a){try{e(b.next(a))}catch(p){r(p)}}function d(a){try{e(b["throw"](a))}catch(p){r(p)}}function e(a){a.done?g(a.value):l(a.value).then(w,d)}e((b=b.apply(a,
c||[])).next())})};Object.defineProperty(m,"__esModule",{value:!0});var k;(function(a){a[a.ERROR_LOADING_FONTS=0]="ERROR_LOADING_FONTS";a[a.TOO_MANY_FONTS_SELECTED=1]="TOO_MANY_FONTS_SELECTED";a[a.ERROR_WHILE_SAVING=2]="ERROR_WHILE_SAVING"})(k||(k={}));var q;(function(a){a[a.FONT_SELECTOR=0]="FONT_SELECTOR";a[a.ERROR=1]="ERROR"})(q||(q={}));const t={filters:{filterText:null,selectedCategory:null,selectedScript:null},fonts:null,filteredFonts:null,selectedFonts:{},selectedFontCount:0,error:null,activeModal:null,
shownFontCount:50},h=f.avro.Avro.createDefaultLogger(),u={[k.ERROR_LOADING_FONTS]:{title:d.I18n.ts("Looks like there was an issue loading fonts"),label:d.I18n.ts("Please check your Internet connection and if the issue continues, contact [support](https://support.prezi.com/).")},[k.TOO_MANY_FONTS_SELECTED]:{title:d.I18n.ts("That\u2019s a few fonts too many"),label:d.I18n.ts("You can have up to 100 fonts in your default list. Please remove a few to add more.")},[k.ERROR_WHILE_SAVING]:{title:d.I18n.ts("Something went wrong while saving your selection"),
label:d.I18n.ts("Please check your Internet connection and if the issue continues, contact [support](https://support.prezi.com/).")}};m.FontSelectorPlugin=class{init(a){this.fontProvider=b.FontProviderModule.getFontProvider(a);this.uiRoot=a.declareUI(t,(a,b)=>{this.createFontSelectorDialog(b,a);this.createErrorDialogs(b,a)});this.fontProvider.onUserSelectedFontsChange(()=>{this.userSelectedFontsChanged()});this.fontProvider.onFontCatalogueChange(()=>{this.fontCatalogueChanged()})}fontCatalogueChanged(){const a=
this.fontProvider.getFontCatalogue();"ok"===a.status?(this.uiRoot.setState({fonts:a.catalogue}),this.applyFilters(this.uiRoot.getState())):"error"===a.status&&(this.uiRoot.setState({error:k.ERROR_LOADING_FONTS}),this.showModal("errorDialog"))}userSelectedFontsChanged(){const a=this.fontProvider.getUserSelectedFonts(),c={};let b=0;a&&(a.forEach((a)=>c[a.fontFamily]=!0),b=a.length);this.uiRoot.setState({selectedFonts:c,selectedFontCount:b})}saveFontSelection(a){return n(this,void 0,void 0,function*(){const b=
Object.keys(a.selectedFonts).map((b)=>({fontFamily:b,selected:a.selectedFonts[b]})).filter((a)=>a.selected).map((a)=>a.fontFamily);try{yield this.fontProvider.saveUserFontSelection(b),this.uiRoot.setState(this.getChangedStateAfterClosing(a)),this.showModal(null)}catch(g){this.uiRoot.setState({error:k.ERROR_LOADING_FONTS}),this.showModal("errorDialog")}})}resetFontSelection(a){return n(this,void 0,void 0,function*(){try{yield this.fontProvider.saveUserFontSelection([]),this.uiRoot.setState(this.getChangedStateAfterClosing(a)),
this.showModal(null)}catch(c){this.uiRoot.setState({error:k.ERROR_LOADING_FONTS}),this.showModal("errorDialog")}})}showModal(a){null!=a?this.uiRoot.dialog.show(a):(this.uiRoot.dialog.hide("fontSelectorDialog"),this.uiRoot.dialog.hide("errorDialog"))}getChangedStateAfterClosing(a){return{activeModal:null,filters:t.filters,filteredFonts:[...a.fonts],shownFontCount:50}}applyFilters(a,b){const c=Object.assign(Object.assign({},a.filters),b);a=[...a.fonts];c.filterText&&(a=a.filter((a)=>a.fontFamily.toLowerCase().includes(c.filterText.toLowerCase())));
c.selectedCategory&&(a=a.filter((a)=>a.category===c.selectedCategory));c.selectedScript&&(a=a.filter((a)=>a.subsets.some((a)=>a===c.selectedScript)));this.uiRoot.setState({filters:c,filteredFonts:a})}createErrorDialogs(a,b){a.dialog.small((a)=>{var c,l;return{id:"errorDialog",title:null===(c=u[b.error])||void 0===c?void 0:c.title,align:e.DialogAlign.center,content:[a.label(null===(l=u[b.error])||void 0===l?void 0:l.label)],footer:(a)=>[a.button({color:e.ButtonColor.Gray,content:{text:d.I18n.ts("Ok")},
id:"alert-close-button",onClick:()=>{this.uiRoot.setState({error:null});this.showModal("fontSelectorDialog")}})]}})}createFontSelectorDialog(a,b){const c=(a)=>{var c;const d=b.fonts?[...this.createFontSelector(a,b)]:[a.spinner(e.SpinnerColor.neutral,e.SpinnerSize.l)];(null===(c=b.filteredFonts)||void 0===c?void 0:c.length)>b.shownFontCount&&d.push(this.createShowMoreButton(a,b));return d};a.dialog.extraLarge((a)=>({id:"fontSelectorDialog",title:d.I18n.ts("Fonts"),height:860,caution:{type:e.CautionTypes.Info,
text:d.I18n.ts("Choose which fonts appear in your default font list when editing and creating presentations")},onCloseButtonClicked:()=>{h.logCancelMoreFontsDialog();this.uiRoot.setState(this.getChangedStateAfterClosing(b))},header:[this.createFilterDialogRow(a,b)],content:c(a),footer:(a)=>[a.button({color:e.ButtonColor.Blue,id:"updateFontsButton",disabled:0===b.selectedFontCount,content:{text:d.I18n.ts("Update fonts")},onClick:()=>n(this,void 0,void 0,function*(){h.logSaveFontList();yield this.saveFontSelection(b)})}),
a.button({color:e.ButtonColor.Ghost,id:"cancelModalButton",content:{text:d.I18n.ts("Cancel")},onClick:()=>{h.logCancelMoreFontsDialog();this.uiRoot.setState(this.getChangedStateAfterClosing(b));this.showModal(null)}}),v.isActive("js-developer-features")?a.button({color:e.ButtonColor.Ghost,id:"resetFontsButton",content:{text:d.I18n.ts("Reset (Staff only)")},onClick:()=>n(this,void 0,void 0,function*(){yield this.resetFontSelection(b)})}):null].filter((a)=>null!=a)}))}createFilterDialogRow(a,c){const g=
(a)=>{if(null==a)return a;a=a.charAt(0).toUpperCase()+a.slice(1);return a.charAt(0)+a.slice(1).replace(/([A-Z])/g," $1")};return a.dialogItemRow((a)=>({layout:e.DialogItemRowLayout.extraLarge_1_1_1,hasBottomBorder:!0,items:[a.searchField({id:"fontFamilySearchField",value:c.filters.filterText,placeholderText:d.I18n.ts("Search..."),onValueChange:(a,b)=>{var d;""===b&&1<(null===(d=c.filters.filterText)||void 0===d?void 0:d.length)?(h.logSearchFontList({search_term:b}),this.applyFilters(c,{filterText:""})):
this.uiRoot.setState({filters:Object.assign(Object.assign({},c.filters),{filterText:b})})},onSearchButtonClick:()=>{h.logSearchFontList({search_term:c.filters.filterText});this.applyFilters(c)},onEnter:()=>{h.logSearchFontList({search_term:c.filters.filterText});this.applyFilters(c)}}),a.dropdown({id:"fontCategoryDropdown",placeholderText:d.I18n.ts("All fonts"),activeId:c.filters.selectedCategory,onChange:(a,b)=>{""===b?h.logFilterFontLists({font_filter_type:"FONT_STYLE",font_filter_value:"ALL_FONTS"}):
h.logFilterFontLists({font_filter_type:"FONT_STYLE",font_filter_value:this.getFontFilterValueLogValue(b)});this.applyFilters(c,{selectedCategory:b})},options:[{id:"",title:d.I18n.ts("All fonts")},...Object.values(b.FontCategory).map((a)=>({id:a,title:g(a.toString())}))]}),a.dropdown({id:"fontScriptDropdown",placeholderText:d.I18n.ts("All scripts"),activeId:c.filters.selectedScript,onChange:(a,b)=>{""===b?h.logFilterFontLists({font_filter_type:"FONT_SCRIPT",font_filter_value:"ALL_SCRIPTS"}):h.logFilterFontLists({font_filter_type:"FONT_SCRIPT",
font_filter_value:this.getFontFilterValueLogValue(b)});this.applyFilters(c,{selectedScript:b})},options:[{id:"",title:d.I18n.ts("All scripts")},...Object.values(b.FontScript).map((a)=>({id:a,title:g(a.toString())}))]})]}))}createShowMoreButton(a,b){return a.button(e.ButtonSize.Large,e.ButtonAlign.Center,(a)=>[a.button({color:e.ButtonColor.Ghost,id:"loadMoreButton",content:{text:d.I18n.ts("Show more")},onClick:()=>{this.uiRoot.setState({shownFontCount:b.shownFontCount+50})}})])}createFontSelector(a,
b){var c;const f=(c,d,f,g)=>a.dialogItemRow((a)=>({layout:e.DialogItemRowLayout.extraLarge_1_2,hasBottomBorder:!1,backgroundColor:g?"#ecedef":"#ffffff",items:[a.checkbox({id:`font-selector-checkbox-${c}`,label:d,checked:g,onCheck:(a,d)=>{h.logConfigureFontList({fontlist_action:d?"ADD_FONT_AS_DEFAULT":"REMOVE_FONT_FROM_DEFAULTS",font_name:c});a=Object.assign(Object.assign({},b.selectedFonts),{[c]:d});d=Object.values(a).filter((a)=>a).length;100<d?(this.uiRoot.setState({error:k.TOO_MANY_FONTS_SELECTED}),
this.showModal("errorDialog")):this.uiRoot.setState({selectedFonts:a,selectedFontCount:d})}}),a.image({id:`${c}-preview`,src:f})]}));return null!==(c=b.filteredFonts)&&void 0!==c&&c.length?b.filteredFonts.slice(0,b.shownFontCount).map((a)=>f(a.fontFamily,a.displayName,a.thumbnailUrls.quickBrownFox,!!b.selectedFonts[a.fontFamily])):[a.illustration(d.I18n.ts("No results"),e.IllustrationLargeLightId.NoResults)]}processMessage(a){switch(a.kind){case "openFontSelectorModal":this.fontCatalogueChanged();
this.userSelectedFontsChanged();this.uiRoot.setState({activeModal:q.FONT_SELECTOR});this.showModal("fontSelectorDialog");break;default:throw Error(a.kind);throw void 0;}}getFontFilterValueLogValue(a){switch(a){case b.FontCategory.Display:return"DISPLAY";case b.FontCategory.Handwriting:return"HANDWRITING";case b.FontCategory.Monospace:return"MONOSPACE";case b.FontCategory.SansSerif:return"SANSSERIF";case b.FontCategory.Serif:return"SERIF";case b.FontScript.Arabic:return"ARABIC";case b.FontScript.Bengali:return"BENGALI";
case b.FontScript.ChineseHongKong:return"CHINESEHONGKONG";case b.FontScript.ChineseSimplified:return"CHINESESIMPLIFIED";case b.FontScript.ChineseTraditional:return"CHINESETRADITIONAL";case b.FontScript.Cyrillic:return"CYRILLIC";case b.FontScript.CyrillicExtended:return"CYRILLICEXTENDED";case b.FontScript.Devanagari:return"DEVANAGARI";case b.FontScript.Ethiopic:return"ETHIOPIC";case b.FontScript.Greek:return"GREEK";case b.FontScript.GreekExtended:return"GREEKEXTENDED";case b.FontScript.Gujarati:return"GUJARATI";
case b.FontScript.Gurmukhi:return"GURMUKHI";case b.FontScript.Hebrew:return"HEBREW";case b.FontScript.Japanese:return"JAPANESE";case b.FontScript.Kannada:return"KANNADA";case b.FontScript.Khmer:return"KHMER";case b.FontScript.Korean:return"KOREAN";case b.FontScript.Lao:return"LAO";case b.FontScript.Latin:return"LATIN";case b.FontScript.LatinExtended:return"LATINEXTENDED";case b.FontScript.Malayalam:return"MALAYALAM";case b.FontScript.Myanmar:return"MYANMAR";case b.FontScript.Oriya:return"ORIYA";case b.FontScript.Sinhala:return"SINHALA";
case b.FontScript.Tamil:return"TAMIL";case b.FontScript.Telugu:return"TELUGU";case b.FontScript.Thai:return"THAI";case b.FontScript.Tibetan:return"TIBETAN";case b.FontScript.Vietnamese:return"VIETNAMESE";default:throw Error("All script values should be converted to log properties!");}}};f={};Object.defineProperty(f,"__esModule",{value:!0});f.lazyModule={createPlugin(){return new m.FontSelectorPlugin}};return f});

})() || {};
moduleImpl["module"]=moduleImpl;
return moduleImpl;};if(typeof define==="function"&&define.amd){define("prezi_font_selector",["require","prezi_cet_model_editor","prezi_featureswitcher","prezi_font_provider","prezi_i18n","prezi_logger","prezi_plugin_api","prezi_plugin_meta","prezi_service_fontcatalogue","prezi_utils","prezi_widgets"],function(){var moduleUrl=arguments[0]["toUrl"]("prezi_font_selector.js");baseUrl=moduleUrl.substr(0,moduleUrl.lastIndexOf("/"));return(__factory).apply({},[].slice.call(arguments,1));});}else if(typeof exports==="object"&&typeof exports.nodeName!=="string"){baseUrl=__dirname;module.exports=(__factory)(require("prezi_cet_model_editor"),require("prezi_featureswitcher"),require("prezi_font_provider"),require("prezi_i18n"),require("prezi_logger"),require("prezi_plugin_api"),require("prezi_plugin_meta"),require("prezi_service_fontcatalogue"),require("prezi_utils"),require("prezi_widgets"));}else{this["prezi_font_selector"]=__factory(this["prezi_cet_model_editor"],this["prezi_featureswitcher"],this["prezi_font_provider"],this["prezi_i18n"],this["prezi_logger"],this["prezi_plugin_api"],this["prezi_plugin_meta"],this["prezi_service_fontcatalogue"],this["prezi_utils"],this["prezi_widgets"]);}}).call(this);