;(function(){var baseUrl;var __factory=function(){var React=arguments[0];var ReactDOM=arguments[1];var ReactTransitionGroup=arguments[2];var module=(function(dependencies){return function(init){return init.call({},(function(){return{getSpaghettiVersion:function(){return "13.0-25-g6015dbc";},getModuleName:function(){return "prezi_templatepreviewcet";},getModuleVersion:function(){return "release-2021w06-base-26-gaeb382e";},getResourceUrl:function(resource){if(resource.substr(0,1)!="/"){resource="/"+resource;}return baseUrl+resource;},"dependencies":{"prezi.engine.dom":dependencies[3],"prezi.engine.dom.converter.xpdom2":dependencies[4],"prezi_app_utils":dependencies[5],"prezi_bacon":dependencies[6],"prezi_canvas_listener":dependencies[7],"prezi_cet":dependencies[8],"prezi_cet_model":dependencies[9],"prezi_cet_model_editor":dependencies[10],"prezi_editor_store_mode":dependencies[11],"prezi_editor_store_object":dependencies[12],"prezi_playback":dependencies[13],"prezi_templatechooser":dependencies[14],"prezi_templatepreview":dependencies[15]}};})(),React,ReactDOM,ReactTransitionGroup);};})(arguments);var moduleImpl=(function(){return module(function(c,e,w,x){var f=c.dependencies.prezi_templatepreview,r=c.dependencies["prezi.engine.dom"],n=c.dependencies.prezi_app_utils,b=c.dependencies.prezi_bacon,p=c.dependencies.prezi_cet_model,t=c.dependencies.prezi_cet_model_editor,u=c.dependencies.prezi_editor_store_object,q=c.dependencies.prezi_playback,k={};Object.defineProperty(k,"__esModule",{value:!0});k.AppHelperImpl=class{constructor(){this.isStarted=!1}getCurrentPathStepIndexForTest(){return this.playback.getCurrentStepIndex()}getBackgroundColorForTest(){const a=
this.cetApplication.getBaseScene().getPreziW().getBackground();return a.getFillType()===p.FillType.Solid?a.getColor():a.getGradStartColor()}getCanvasLayerDiv(){return this.cetApplication.getCetUI().getCanvasContainer()}getDomLayerDiv(){return this.cetApplication.getCetUI().getDomLayer()}getPreviewLoadFinished(){null==this.previewLoaded&&(this.previewLoaded=new Promise((a)=>{this.previewLoadedResolve=a}));return this.previewLoaded}setDocument(a){a=r.DOM.loadXml(a);return this.cetApplication.updateWithTemplate(a).then(()=>
{this.playback.reset();null!=this.previewLoadedResolve&&(this.previewLoadedResolve(),this.previewLoaded=this.previewLoadedResolve=null)})}goToPrevious(){return new Promise((a)=>this.playback.navigateBackward(a))}hasNext(){return this.playback.hasNext()}hasPrevious(){return this.playback.hasPrevious()}goToNext(){return new Promise((a)=>this.playback.navigateForward(a))}goToFirst(){return new Promise((a)=>this.playback.flyToStep(0,a))}getStepIndex(){return this.playback.getCurrentStepIndex()}getStepCount(){return this.playback.getStepCount()}start(a,
d){if(this.isStarted)return this;this.cetApplication=d.createSubCetApplication({speedMeasurementOptions:{measureSpeed:!1}},t.CetModelEditor.cetSessionFactory().createCetSessionWithIPrezi(p.CetModel.EMPTY_PREZI()),!0);d=this.cetApplication.getCetUI();d.resize({width:890,height:501});d.getCanvas().style.position="relative";d=d.getCanvasContainer();d.style.width="100%";d.style.height="100%";d=b.Bacon.newBus();const c=q.PlaybackModule.createPlaybackScene(this.cetApplication,this.cetApplication.getMainStage(),
"template-chooser",d.toProperty(null),b.Bacon.never().toProperty(null),b.Bacon.once(n.EditorMode.templateChooser).toProperty(n.EditorMode.templateChooser),b.Bacon.never().toProperty(null),b.Bacon.never(),b.Bacon.never());this.playback=q.PlaybackModule.createPlayback(this.cetApplication,c);this.playback.initInteractionStreams(a,b.Bacon.newBus(),b.Bacon.newBus(),b.Bacon.newBus().toProperty(),b.Bacon.newBus(),b.Bacon.newBus().toProperty(),b.Bacon.once(!1).toProperty(),b.Bacon.once(null).toProperty(),
b.Bacon.newBus().toProperty(u.emptySelectionInfo()));this.playback.setSceneStream(b.Bacon.newBus().toProperty(c));this.playback.setCameraNavigationStream(this.cetApplication.getMainStage().getNavigationActions());a=this.playback.getCurrentTopicActionStream().map((a)=>a.newCurrentTopic).toProperty(null);d.plug(this.playback.getCurrentTopicActionStream());this.playback.setupSceneChangeHandler(a);this.cetApplication.initializeLoop(b.Bacon.newBus());this.cetApplication.startLoop();this.isStarted=!0;this.reset();
this.cetApplication.getMainStage().getRenderer().setEnabled(!0);return this}reset(){this.cetApplication.resetToEmptyPrezi()}};var g={};Object.defineProperty(g,"__esModule",{value:!0});g.PreviewCetAppContainer=class extends e.Component{constructor(){super(...arguments);this.setAppContainer=(a)=>this.appContainer=a}componentDidMount(){null!=this.props.appHelper&&(this.appContainer.appendChild(this.props.appHelper.getCanvasLayerDiv()),this.appContainer.appendChild(this.props.appHelper.getDomLayerDiv()))}render(){return e.createElement("div",
{style:{width:"100%",height:"100%",overflow:"hidden"}},e.createElement("div",{className:"app-container",style:this.props.isBlurred?{filter:"blur(5px)"}:{},ref:this.setAppContainer,"data-lookup":"preview-canvas",onClick:this.props.pulsateStartEditingButton,onDoubleClick:this.props.pulsateStartEditingButton}))}};var h={},v=this&&h.__awaiter||function(a,d,b,c){function e(a){return a instanceof b?a:new b(function(b){b(a)})}return new (b||(b=Promise))(function(b,f){function h(a){try{g(c.next(a))}catch(l){f(l)}}
function k(a){try{g(c["throw"](a))}catch(l){f(l)}}function g(a){a.done?b(a.value):e(a.value).then(h,k)}g((c=c.apply(a,d||[])).next())})};Object.defineProperty(h,"__esModule",{value:!0});h.TemplatePreviewCet=class extends e.Component{constructor(){super(...arguments);this.goToCancelablePromises=[];this.handleError=(a)=>{f.isCancelled(a)||this.setState({error:a})};this.goToNext=()=>{if(this.props.appHelper.hasNext()){var a=f.makeCancelablePromise(this.props.appHelper.goToNext());this.goToCancelablePromises.push(a);
a.getPromise().then(()=>{this.setState({isFirstStep:!1,isLastStep:!this.props.appHelper.hasNext(),step:this.props.appHelper.getStepIndex()})},this.handleError)}};this.goToPrevious=()=>{if(this.props.appHelper.hasPrevious()){var a=f.makeCancelablePromise(this.props.appHelper.goToPrevious());this.goToCancelablePromises.push(a);a.getPromise().then(()=>{this.setState({isFirstStep:!this.props.appHelper.hasPrevious(),isLastStep:!1,step:this.props.appHelper.getStepIndex()})},this.handleError)}};this.goToFirst=
()=>{const a=f.makeCancelablePromise(this.props.appHelper.goToFirst());this.goToCancelablePromises.push(a);a.getPromise().then(()=>{this.setState({isFirstStep:!0,isLastStep:!1,step:0})},this.handleError)};this.state={templateXml:null,isFirstStep:!0,isLastStep:!1,step:0,error:null,totalStepCount:0}}componentDidMount(){return v(this,void 0,void 0,function*(){this.loadTemplatePreviewXml=f.makeCancelablePromise(this.props.templateService.loadTemplatePreviewXml(this.props.selectedTemplate.templateId,null));
try{const a=yield this.loadTemplatePreviewXml.getPromise();yield this.props.appHelper.setDocument(a);this.setState({templateXml:a,isFirstStep:!0,isLastStep:!1,totalStepCount:this.props.appHelper.getStepCount()})}catch(a){this.handleError(a)}})}componentWillUnmount(){this.loadTemplatePreviewXml.cancel();this.goToCancelablePromises.forEach((a)=>a.cancel())}render(){return e.createElement(f.PreviewPlayerComponent,Object.assign({selectedTemplate:this.props.selectedTemplate,handlePreviewClose:this.props.handlePreviewClose,
loadingOverlay:null==this.state.templateXml,startEditingController:this.props.startEditingController,isFirstStep:this.state.isFirstStep,isLastStep:this.state.isLastStep,goToNext:this.goToNext,goToPrevious:this.goToPrevious,goToFirst:this.goToFirst,step:this.state.step,pulsateButton:this.props.pulsateButton,pulsateStartEditingButton:this.props.pulsateStartEditingButton,isError:null!=this.state.error,error:this.state.error,totalStepCount:this.state.totalStepCount},this.props.privacyPaywallPreviewProps,
{afterCreateAction:this.props.afterCreateAction}),e.createElement(g.PreviewCetAppContainer,{appHelper:this.props.appHelper,pulsateStartEditingButton:this.props.pulsateStartEditingButton,isBlurred:this.state.isLastStep}),this.props.children)}};var m={};Object.defineProperty(m,"__esModule",{value:!0});m.TemplatePreviewCetControllerImpl=class{constructor(a,b){this.shortcutInteractions=a;this.mainApp=b;this.appHelper=new k.AppHelperImpl}getTestHelper(){return this.appHelper}createTemplatePreviewCet(a){this.appHelper.start(this.shortcutInteractions,
this.mainApp);return e.createElement(h.TemplatePreviewCet,Object.assign({appHelper:this.appHelper},a))}};c={createTemplatePreviewCetController:function(a,b){return new m.TemplatePreviewCetControllerImpl(a,b)}};Object.defineProperty(c,"__esModule",{value:!0});return c});

})() || {};
moduleImpl["module"]=moduleImpl;
return moduleImpl;};if(typeof define==="function"&&define.amd){define("prezi_templatepreviewcet",["require","react","react-dom","react-transition-group","prezi.engine.dom","prezi.engine.dom.converter.xpdom2","prezi_app_utils","prezi_bacon","prezi_canvas_listener","prezi_cet","prezi_cet_model","prezi_cet_model_editor","prezi_editor_store_mode","prezi_editor_store_object","prezi_playback","prezi_templatechooser","prezi_templatepreview"],function(){var moduleUrl=arguments[0]["toUrl"]("prezi_templatepreviewcet.js");baseUrl=moduleUrl.substr(0,moduleUrl.lastIndexOf("/"));return(__factory).apply({},[].slice.call(arguments,1));});}else if(typeof exports==="object"&&typeof exports.nodeName!=="string"){baseUrl=__dirname;module.exports=(__factory)(require("react"),require("react-dom"),require("react-transition-group"),require("prezi.engine.dom"),require("prezi.engine.dom.converter.xpdom2"),require("prezi_app_utils"),require("prezi_bacon"),require("prezi_canvas_listener"),require("prezi_cet"),require("prezi_cet_model"),require("prezi_cet_model_editor"),require("prezi_editor_store_mode"),require("prezi_editor_store_object"),require("prezi_playback"),require("prezi_templatechooser"),require("prezi_templatepreview"));}else{this["prezi_templatepreviewcet"]=__factory(React,ReactDOM,ReactTransitionGroup,this["prezi.engine.dom"],this["prezi.engine.dom.converter.xpdom2"],this["prezi_app_utils"],this["prezi_bacon"],this["prezi_canvas_listener"],this["prezi_cet"],this["prezi_cet_model"],this["prezi_cet_model_editor"],this["prezi_editor_store_mode"],this["prezi_editor_store_object"],this["prezi_playback"],this["prezi_templatechooser"],this["prezi_templatepreview"]);}}).call(this);